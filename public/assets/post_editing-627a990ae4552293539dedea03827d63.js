// Global variables
function codeLatLng(a,b,c){c&&c.geocode({latLng:a,language:"en"},function(c,d){var e=parse_google_result(c,d,a,b);e.address!=undefined?$("#address_from_api").html(e.address):$("#address_from_api").html(e.error),$("#post_map_data").val(e.output.join("; "))})}function processSVData(a,b){b==google.maps.StreetViewStatus.OK?(panorama.setVisible(!0),panorama.setPano(a.location.pano),panorama.setPov({heading:270,pitch:0,zoom:1})):panorama.setVisible(!1)}function zoomChanged(a){a.getMapTypeId()=="roadmap"&&a.getZoom()<13?a.setMapTypeId("terrain"):a.getMapTypeId()=="terrain"&&a.getZoom()>=13&&a.setMapTypeId("roadmap")}function handleEnter(a,b,c,d,e,f){var g=b.keyCode?b.keyCode:b.which?b.which:b.charCode;g==13&&(my_geocode(c,d,e,f),b.preventDefault())}function my_geocode(a,b,c,d){var e=$("#post_address_by_user").val();e!=""&&a.geocode({address:e,partialmatch:!0,language:"en"},function(e,f){geocodeResult(e,f,a,b,c,d)})}function geocodeResult(a,b,c,d,e,f){if(b=="OK"&&a.length>0){var g=a[0].geometry.viewport.getCenter();d.setZoom(11),d.fitBounds(a[0].geometry.viewport),d.setCenter(a[0].geometry.location),pos=a[0].geometry.location,e.setPosition(pos),f&&(f=!1,e.setVisible(!0)),codeLatLng(pos,d,c)}else alert("Address not found: "+b)}function round(a){return Math.round(a*decimals)/decimals}function simple_parse_results(a){var b="";for(var c in a)for(var d in a[c].types)if(a[c]["types"][d]!="political"){var e="";c==0&&(e=" ("+a[c].formatted_address+") "),b=b+c+" "+a[c].types[d]+": "+a[c].address_components[0].long_name+e+a[c].geometry.bounds+"\n"}return b}decimals=1e6,$(document).ready(function(){var a=!0,b=$("#bounds").html().split(" "),c=!0;$("#bounds").html()=="-20000000 000000000 50000000 360000000"&&(c=!1);var d=new google.maps.LatLng(parseFloat(b[0])/decimals,parseFloat(b[1])/decimals),e=new google.maps.LatLng(parseFloat(b[2])/decimals,parseFloat(b[3])/decimals),f=!1,g,h,i,e,d;$("#post_map_lat").html()!=""&&$("#post_map_lng").html()!=""&&(g=new google.maps.LatLng($("#post_map_lat").html()/decimals,$("#post_map_lng").html()/decimals),i=$("#post_map_zoom").html()*1,f=!0);var h=new google.maps.LatLngBounds(d,e),j=[e,new google.maps.LatLng(e.lat(),d.lng()),d,new google.maps.LatLng(d.lat(),e.lng()),e],k=new google.maps.Polyline({path:j,strokeColor:"brown",strokeOpacity:.6,strokeWeight:1}),l=new google.maps.Geocoder,m={center:g,zoom:i,streetViewControl:!1,mapTypeControl:!0,panControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_TOP},scaleControl:!0,scaleControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},mapTypeId:google.maps.MapTypeId.TERRAIN},n=new google.maps.Map(document.getElementById("map_canvas"),m);f||n.fitBounds(h),c&&k.setMap(n);var o={position:g,map:n,title:"Hello World!",visible:!0,draggable:!0},p=new google.maps.Marker(o);google.maps.event.addListener(n,"click",function(b){a&&(a=!1,p.setVisible(!0)),p.setPosition(b.latLng),codeLatLng(b.latLng,n,l)}),google.maps.event.addListener(p,"dragend",function(a){codeLatLng(a.latLng,n,l)}),google.maps.event.addListener(n,"zoom_changed",function(){zoomChanged(n)}),$("#post_address_by_user").keypress(function(){return handleEnter(this,event,l,n,p,a)}),$("#find_button").click(function(){my_geocode(l,n,p,a)})})